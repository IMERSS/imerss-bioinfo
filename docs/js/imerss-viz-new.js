!function(i,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((i||self).preactSignalsCore={})}(this,(function(i){function t(){throw new Error("Cycle detected")}var n=Symbol.for("preact-signals");function o(){if(s>1)s--;else{for(var i,t=!1;void 0!==h;){var n=h;for(h=void 0,e++;void 0!==n;){var o=n.o;if(n.o=void 0,n.f&=-3,!(8&n.f)&&c(n))try{n.c()}catch(n){t||(i=n,t=!0)}n=o}}if(e=0,s--,t)throw i}}var r=void 0,f=0,h=void 0,s=0,e=0,v=0;function u(i){if(void 0!==r){var t=i.n;if(void 0===t||t.t!==r)return t={i:0,S:i,p:r.s,n:void 0,t:r,e:void 0,x:void 0,r:t},void 0!==r.s&&(r.s.n=t),r.s=t,i.n=t,32&r.f&&i.S(t),t;if(-1===t.i)return t.i=0,void 0!==t.n&&(t.n.p=t.p,void 0!==t.p&&(t.p.n=t.n),t.p=r.s,t.n=void 0,r.s.n=t,r.s=t),t}}function d(i){this.v=i,this.i=0,this.n=void 0,this.t=void 0}function c(i){for(var t=i.s;void 0!==t;t=t.n)if(t.S.i!==t.i||!t.S.h()||t.S.i!==t.i)return!0;return!1}function a(i){for(var t=i.s;void 0!==t;t=t.n){var n=t.S.n;if(void 0!==n&&(t.r=n),t.S.n=t,t.i=-1,void 0===t.n){i.s=t;break}}}function l(i){for(var t=i.s,n=void 0;void 0!==t;){var o=t.p;-1===t.i?(t.S.U(t),void 0!==o&&(o.n=t.n),void 0!==t.n&&(t.n.p=o)):n=t,t.S.n=t.r,void 0!==t.r&&(t.r=void 0),t=o}i.s=n}function y(i){d.call(this,void 0),this.x=i,this.s=void 0,this.g=v-1,this.f=4}function w(i){var t=i.u;if(i.u=void 0,"function"==typeof t){s++;var n=r;r=void 0;try{t()}catch(t){throw i.f&=-2,i.f|=8,p(i),t}finally{r=n,o()}}}function p(i){for(var t=i.s;void 0!==t;t=t.n)t.S.U(t);i.x=void 0,i.s=void 0,w(i)}function b(i){if(r!==this)throw new Error("Out-of-order effect");l(this),r=i,this.f&=-2,8&this.f&&p(this),o()}function g(i){this.x=i,this.u=void 0,this.s=void 0,this.o=void 0,this.f=32}function _(i){var t=new g(i);try{t.c()}catch(i){throw t.d(),i}return t.d.bind(t)}d.prototype.brand=n,d.prototype.h=function(){return!0},d.prototype.S=function(i){this.t!==i&&void 0===i.e&&(i.x=this.t,void 0!==this.t&&(this.t.e=i),this.t=i)},d.prototype.U=function(i){if(void 0!==this.t){var t=i.e,n=i.x;void 0!==t&&(t.x=n,i.e=void 0),void 0!==n&&(n.e=t,i.x=void 0),i===this.t&&(this.t=n)}},d.prototype.subscribe=function(i){var t=this;return _((function(){var n=t.value,o=32&this.f;this.f&=-33;try{i(n)}finally{this.f|=o}}))},d.prototype.valueOf=function(){return this.value},d.prototype.toString=function(){return this.value+""},d.prototype.toJSON=function(){return this.value},d.prototype.peek=function(){return this.v},Object.defineProperty(d.prototype,"value",{get:function(){var i=u(this);return void 0!==i&&(i.i=this.i),this.v},set:function(i){if(r instanceof y&&function(){throw new Error("Computed cannot have side-effects")}(),i!==this.v){e>100&&t(),this.v=i,this.i++,v++,s++;try{for(var n=this.t;void 0!==n;n=n.x)n.t.N()}finally{o()}}}}),(y.prototype=new d).h=function(){if(this.f&=-3,1&this.f)return!1;if(32==(36&this.f))return!0;if(this.f&=-5,this.g===v)return!0;if(this.g=v,this.f|=1,this.i>0&&!c(this))return this.f&=-2,!0;var i=r;try{a(this),r=this;var t=this.x();(16&this.f||this.v!==t||0===this.i)&&(this.v=t,this.f&=-17,this.i++)}catch(i){this.v=i,this.f|=16,this.i++}return r=i,l(this),this.f&=-2,!0},y.prototype.S=function(i){if(void 0===this.t){this.f|=36;for(var t=this.s;void 0!==t;t=t.n)t.S.S(t)}d.prototype.S.call(this,i)},y.prototype.U=function(i){if(void 0!==this.t&&(d.prototype.U.call(this,i),void 0===this.t)){this.f&=-33;for(var t=this.s;void 0!==t;t=t.n)t.S.U(t)}},y.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(var i=this.t;void 0!==i;i=i.x)i.t.N()}},y.prototype.peek=function(){if(this.h()||t(),16&this.f)throw this.v;return this.v},Object.defineProperty(y.prototype,"value",{get:function(){1&this.f&&t();var i=u(this);if(this.h(),void 0!==i&&(i.i=this.i),16&this.f)throw this.v;return this.v}}),g.prototype.c=function(){var i=this.S();try{if(8&this.f)return;if(void 0===this.x)return;var t=this.x();"function"==typeof t&&(this.u=t)}finally{i()}},g.prototype.S=function(){1&this.f&&t(),this.f|=1,this.f&=-9,w(this),a(this),s++;var i=r;return r=this,b.bind(this,i)},g.prototype.N=function(){2&this.f||(this.f|=2,this.o=h,h=this)},g.prototype.d=function(){this.f|=8,1&this.f||p(this)},i.Signal=d,i.batch=function(i){if(s>0)return i();s++;try{return i()}finally{o()}},i.computed=function(i){return new y(i)},i.effect=_,i.signal=function(i){return new d(i)},i.untracked=function(i){if(f>0)return i();var t=r;r=void 0,f++;try{return i()}finally{f--,r=t}}})),function(){function n(t,n,e,r,a,i){if(0>=a||0>=r)return 0;var u=t.concat().sort(d3.ascending),o=r-u.length*n+(i?n:0),s=[],c=0,d=0;return d3.range(u.length).forEach((function(t){d=(o-e*t)/(a-=u[t-1]||0),c+=u[t]*d<=e?1:0,s.push(d)})),s[c]}function e(t,e,r,a,i){var u=a,o=d3.sum(t),s=n(t,e,r,i-a,o,!1),c=t.map((function(t){var n=s*t,a=(r>n?r:n)/2;return{c:(u+=2*a+e)-a,v:n,w:a,value:t,percent:t/(o||1)}}));return c}function r(t){function n(t,n){return[t*Math.cos(n),t*Math.sin(n)]}var e=n(t[0],t[2]),r=n(t[0],t[3]),a=n(t[1],t[2]),i=n(t[1],t[3]);return["M",e,"A",t[0],t[0],"0",t[3]-t[2]>s?1:0,"1",r,"L",i,"A",t[1],t[1],"0",t[3]-t[2]>s?1:0,"0",a,"z"].join(" ")}function a(t,n,e,r,a,i){function u(t,n,e){return"A"+t+","+t+" 0 "+ +(e>s)+",1 "+n}function c(t,n){return[t*Math.cos(n),t*Math.sin(n)]}function d(t,n,e,r){var a=(e+=n>e?o:0)-n,i=1-(a>s?o-a:a)/s;i=Math.pow(i,5);var u=(e+n)/2-(e-n>s?s:0);return"Q"+i*r*Math.cos(u)+","+i*r*Math.sin(u)+" "+t}var f=c(t,n),l=c(t,e),g=c(r,a),p=c(r,i);return"M"+f+u(t,l,e-n)+(n==a&&e==i?d(f,n,e,r):d(g,e,a,r)+u(r,p,i-a)+d(f,n,i,t))+"Z"}function i(t,n){ret=[];for(var e=n;e>n-t;e--)ret.push(0>e?e+t:e);return ret}var u={version:"1.1.0"},o=2*Math.PI,s=Math.PI,c=Math.PI/2;u.bP=function(){function t(i){y=i,i.each((function(){var i=d3.select(this),u=t.bars(),o=i.selectAll(".subBars").data(u.subBars).enter().append("g").attr("transform",(function(t){return"translate("+t.x+","+t.y+")"})).attr("class","subBars").append("rect").attr("x",n).attr("y",e).attr("width",r).attr("height",a);void 0!==h&&o.style("fill",(function(t){return h(t)}));var s=i.selectAll(".edges").data(u.edges).enter().append("path").attr("class","edges").attr("d",(function(t){return t.path})).style("fill-opacity",t.edgeOpacity());void 0!==h&&s.style("fill",(function(t){return h(t)})),i.selectAll(".mainBars").data(u.mainBars).enter().append("g").attr("transform",(function(t){return"translate("+t.x+","+t.y+")"})).attr("class","mainBars").append("rect").attr("x",n).attr("y",e).attr("width",r).attr("height",a).style("fill-opacity",0).on("mouseover",t.mouseover).on("mouseout",t.mouseout)}))}function n(t){return-t.width}function e(t){return-t.height}function r(t){return 2*t.width}function a(t){return 2*t.height}var i,u,o,s,c,d,f,l,g,p,h,y,m,v,A,x,k;return t.data=function(n){return arguments.length?(p=n,t):p},t.fill=function(n){return arguments.length?(h=n,t):h},t.keyPrimary=function(n){return arguments.length?(i=n,t):void 0!==i?i:function(t){return t[0]}},t.sortPrimary=function(n){return arguments.length?(A=n,t):void 0!==A?A:d3.ascending},t.keySecondary=function(n){return arguments.length?(u=n,t):void 0!==u?u:function(t){return t[1]}},t.sortSecondary=function(n){return arguments.length?(x=n,t):void 0!==x?x:d3.ascending},t.value=function(n){return arguments.length?(o=n,t):void 0!==o?o:function(t){return t[2]}},t.width=function(n){return arguments.length?(s=n,t):void 0!==s?s:400},t.height=function(n){return arguments.length?(c=n,t):void 0!==c?c:600},t.barSize=function(n){return arguments.length?(f=n,t):void 0!==f?f:35},t.min=function(n){return arguments.length?(l=n,t):void 0!==l?l:0},t.orient=function(n){return arguments.length?(d=n,t):void 0!==d?d:"vertical"},t.pad=function(n){return arguments.length?(g=n,t):void 0!==g?g:0},t.duration=function(n){return arguments.length?(v=n,t):void 0!==v?v:500},t.edgeOpacity=function(n){return arguments.length?(m=n,t):void 0!==m?m:.4},t.edgeMode=function(n){return arguments.length?(k=n,t):void 0!==k?k:"curved"},t.bars=function(n){function e(t,e){return void 0===n||n.part===e||d[n.part](t)===n.key}function a(n){function r(r){return e(r,n)?t.value()(r):0}var a=d3.nest().key("primary"==n?t.keyPrimary():t.keySecondary()).sortKeys("primary"==n?t.sortPrimary():t.sortSecondary()).rollup((function(t){return d3.sum(t,r)})).entries(t.data()),i=o(a,t.pad(),t.min(),0,"vertical"==f?t.height():t.width()),u=t.barSize();a.forEach((function(e,r){s[n].push({x:"horizontal"==f?(i[r].s+i[r].e)/2:"primary"==n?u/2:t.width()-u/2,y:"vertical"==f?(i[r].s+i[r].e)/2:"primary"==n?u/2:t.height()-u/2,height:"vertical"==f?(i[r].e-i[r].s)/2:u/2,width:"horizontal"==f?(i[r].e-i[r].s)/2:u/2,part:n,key:e.key,value:e.value,percent:i[r].p})}))}function i(n){function r(r){return e(r,n)?t.value()(r):0}var a=d3.map(s[n],(function(t){return t.key}));d3.nest().key("primary"==n?t.keyPrimary():t.keySecondary()).sortKeys("primary"==n?t.sortPrimary():t.sortSecondary()).key("secondary"==n?t.keyPrimary():t.keySecondary()).sortKeys("secondary"==n?t.sortPrimary():t.sortSecondary()).rollup((function(t){return d3.sum(t,r)})).entries(t.data()).forEach((function(e){var r=a.get(e.key),i=o(e.values,0,0,"vertical"==f?r.y-r.height:r.x-r.width,"vertical"==f?r.y+r.height:r.x+r.width),u=t.barSize();e.values.forEach((function(a,o){c[n].push({x:"vertical"==f?"primary"==n?u/2:t.width()-u/2:(i[o].s+i[o].e)/2,y:"horizontal"==f?"primary"==n?u/2:t.height()-u/2:(i[o].s+i[o].e)/2,height:("vertical"==f?i[o].e-i[o].s:u)/2,width:("horizontal"==f?i[o].e-i[o].s:u)/2,part:n,primary:"primary"==n?e.key:a.key,secondary:"primary"==n?a.key:e.key,value:a.value,percent:i[o].p*r.percent,index:"primary"==n?e.key+"|"+a.key:a.key+"|"+e.key})}))}))}function o(t,n,e,r,a){var i=e/(a-r-2*t.length*n),u=0,o=0,s=d3.sum(t,(function(t){return t.value}));t.forEach((function(t){t.value<i*s&&(u+=1,o+=t.value)}));var c=1e-5>s?0:(a-r-2*t.length*n-u*e)/(s-o),d=r,f=[];return t.forEach((function(t){var r=t.value*c;f.push({s:d+n+(e>r?.5*(e-r):0),e:d+n+(e>r?.5*(e+r):r),p:1e-5>s?0:t.value/s}),d+=2*n+(e>r?e:r)})),f}var s={primary:[],secondary:[]},c={primary:[],secondary:[]},d={primary:t.keyPrimary(),secondary:t.keySecondary()},f=t.orient();return a("primary"),a("secondary"),i("primary"),i("secondary"),function(){var n=t.min()/2;s.primary.forEach((function(t){t.height<n&&(t.height=n)})),s.secondary.forEach((function(t){t.height<n&&(t.height=n)}))}(),{mainBars:s.primary.concat(s.secondary),subBars:c.primary.concat(c.secondary),edges:function(){function n(t,n,e,r,i,u,o,s){if("straight"==a)return["M",t,",",n,"L",e,",",r,"L",i,",",u,"L",o,",",s,"z"].join("");var c=(t+e)/2,d=(i+o)/2;return["M",t,",",n,"C",c,",",n," ",c,",",r,",",e,",",r,"L",i,",",u,"C",d,",",u," ",d,",",s,",",o,",",s,"z"].join("")}function e(t,n,e,r,i,u,o,s){if("straight"==a)return["M",t,",",n,"L",e,",",r,"L",i,",",u,"L",o,",",s,"z"].join("");var c=(n+r)/2,d=(u+s)/2;return["M",t,",",n,"C",t,",",c," ",e,",",c,",",e,",",r,"L",i,",",u,"C",i,",",d," ",o,",",d,",",o,",",s,"z"].join("")}var r=d3.map(c.secondary,(function(t){return t.index})),a=t.edgeMode();return c.primary.map((function(t){var a=r.get(t.index);return{path:"vertical"===f?n(t.x+t.width,t.y+t.height,a.x-a.width,a.y+a.height,a.x-a.width,a.y-a.height,t.x+t.width,t.y-t.height):e(t.x-t.width,t.y+t.height,a.x-a.width,a.y-a.height,a.x+a.width,a.y-a.height,t.x+t.width,t.y+t.height),primary:t.primary,secondary:t.secondary,value:t.value,percent:t.percent}}))}()}},t.mouseover=function(i){var u=t.bars(i);y.selectAll(".mainBars").filter((function(t){return t.part===i.part&&t.key===i.key})).select("rect").style("stroke-opacity",1),y.selectAll(".subBars").data(u.subBars).transition().duration(t.duration()).attr("transform",(function(t){return"translate("+t.x+","+t.y+")"})).select("rect").attr("x",n).attr("y",e).attr("width",r).attr("height",a);var o=y.selectAll(".edges").data(u.edges);o.filter((function(t){return t[i.part]===i.key})).transition().duration(t.duration()).style("fill-opacity",t.edgeOpacity()).attr("d",(function(t){return t.path})),o.filter((function(t){return t[i.part]!==i.key})).transition().duration(t.duration()).style("fill-opacity",0).attr("d",(function(t){return t.path})),y.selectAll(".mainBars").data(u.mainBars).transition().duration(t.duration()).attr("transform",(function(t){return"translate("+t.x+","+t.y+")"})).select("rect").attr("x",n).attr("y",e).attr("width",r).attr("height",a)},t.mouseout=function(i){var u=t.bars();y.selectAll(".mainBars").filter((function(t){return t.part===i.part&&t.key===i.key})).select("rect").style("stroke-opacity",0),y.selectAll(".subBars").data(u.subBars).transition().duration(t.duration()).attr("transform",(function(t){return"translate("+t.x+","+t.y+")"})).select("rect").attr("x",n).attr("y",e).attr("width",r).attr("height",a),y.selectAll(".edges").data(u.edges).transition().duration(t.duration()).style("fill-opacity",t.edgeOpacity()).attr("d",(function(t){return t.path})),y.selectAll(".mainBars").data(u.mainBars).transition().duration(t.duration()).attr("transform",(function(t){return"translate("+t.x+","+t.y+")"})).select("rect").attr("x",n).attr("y",e).attr("width",r).attr("height",a)},t},u.gg=function(){function t(n){g=n,n.each((function(){var n=d3.select(this),e=t.scale(),r=t.minorTickStart(),a=t.minorTickEnd(),i=t.majorTickStart(),u=t.majorTickEnd(),o=t.ticks(),c=t.majorTicks(),d=t.labelLocation(),f=t.outerRadius();n.append("circle").attr("r",f).style("fill","url(#vizgg3"+p+")").attr("class","face"),n.append("circle").attr("r",t.innerRadius()).style("fill","url(#vizgg2"+p+")").style("filter","url(#vizgg5"+p+")").attr("class","innerFace"),n.append("g").selectAll("line").data(o).enter().append("line").attr("class",(function(t){return c(t)?"majorTicks":"minorTicks"})).attr("x1",(function(t){return f*(c(t)?i:r)*Math.cos(e(t))})).attr("y1",(function(t){return f*(c(t)?i:r)*Math.sin(e(t))})).attr("x2",(function(t){return f*(c(t)?u:a)*Math.cos(e(t))})).attr("y2",(function(t){return f*(c(t)?u:a)*Math.sin(e(t))})),n.selectAll("text").data(o.filter(c)).enter().append("text").attr("class","label").attr("x",(function(t){return f*d*Math.cos(e(t))})).attr("y",(function(t){return f*d*Math.sin(e(t))})).attr("dy",3).text((function(t){return t}));var g=t.outerRadius()/b.outerRadius,h=180*t.scale()(t.value())/s+90;n.append("g").attr("transform","translate(1,1)").selectAll(".needleshadow").data([0]).enter().append("g").attr("transform","rotate("+h+")").attr("class","needleshadow").append("path").attr("d",["m 0",-130*g,5*g,175*g,-10*g,"0,z"].join(",")).style("filter","url(#vizgg6"+p+")"),n.selectAll(".needle").data([0]).enter().append("g").attr("transform","rotate("+h+")").attr("class","needle").append("polygon").attr("points",[-.5*g,-130*g,.5*g,-130*g,5*g,45*g,-5*g,45*g].join(",")).style("fill","url(#vizgg4"+p+")")}))}var n,e,r,a,i,o,c,d,f,l,g,p,h,y,m,v,A,x,k,b={innerRadius:20,outerRadius:150,angleOffset:.7,startAngle:-1.5*s,endAngle:.5*s,minorTickStart:.9,minorTickEnd:.95,majorTickStart:.82,majorTickEnd:.95,needleColor:"#de2c2c",innerFaceColor:"#999999",faceColor:"#666666",domain:[0,100],duration:500,ease:"cubicInOut",ticks:d3.range(0,101,2),majorTicks:function(t){return t%10==0},labelLocation:.7};return t.scale=function(){return d3.scale.linear().domain(t.domain()).range([b.startAngle+t.angleOffset(),b.endAngle-t.angleOffset()])},t.innerRadius=function(e){return arguments.length?(n=e,t):void 0!==n?n:b.innerRadius},t.outerRadius=function(n){return arguments.length?(e=n,t):void 0!==e?e:b.outerRadius},t.angleOffset=function(n){return arguments.length?(d=n,t):void 0!==d?d:b.angleOffset},t.labelLocation=function(n){return arguments.length?(k=n,t):void 0!==k?k:b.labelLocation},t.ticks=function(n){return arguments.length?(h=n,t):void 0!==h?h:b.ticks},t.majorTicks=function(n){return arguments.length?(y=n,t):void 0!==y?y:b.majorTicks},t.minorTickStart=function(n){return arguments.length?(m=n,t):void 0!==m?m:b.minorTickStart},t.minorTickEnd=function(n){return arguments.length?(v=n,t):void 0!==v?v:b.minorTickEnd},t.majorTickStart=function(n){return arguments.length?(A=n,t):void 0!==A?A:b.majorTickStart},t.majorTickEnd=function(n){return arguments.length?(x=n,t):void 0!==x?x:b.majorTickEnd},t.needleColor=function(n){return arguments.length?(r=n,t):void 0!==r?r:b.needleColor},t.innerFaceColor=function(n){return arguments.length?(a=n,t):void 0!==a?a:b.innerFaceColor},t.faceColor=function(n){return arguments.length?(i=n,t):void 0!==i?i:b.faceColor},t.domain=function(n){return arguments.length?(o=n,t):void 0!==o?o:b.domain},t.duration=function(n){return arguments.length?(f=n,t):void 0!==f?f:b.duration},t.ease=function(n){return arguments.length?(l=n,t):void 0!==l?l:b.ease},t.value=function(n){return arguments.length?(c=n,t):void 0!==c?c:.5*(b.domain[0]+b.domain[1])},t.defs=function(n,e){var r=n.append("defs");p=e;var a=t.needleColor(),i=t.innerFaceColor(),o=t.faceColor(),s=u.defs(r).lG().id("vizgg1"+e).sel();u.defs(s).stop().offset("0").stopColor(a),u.defs(s).stop().offset("1").stopColor(d3.rgb(a).darker(1));var c=u.defs(r).rG().id("vizgg2"+e).fx("35%").fy("65%").r("65%").spreadMethod("pad").sel();u.defs(c).stop().offset("0").stopColor(i),u.defs(c).stop().offset("1").stopColor(d3.rgb(i).darker(2));var d=u.defs(r).rG().id("vizgg3"+e).fx("35%").fy("65%").r("65%").spreadMethod("pad").sel();u.defs(d).stop().offset("0").stopColor(o),u.defs(d).stop().offset("1").stopColor(d3.rgb(o).darker(2)),u.defs(r).lG().id("vizgg4"+e).gradientUnits("userSpaceOnUse").y1("80").x1("-10").y2("80").x2("10").xlink("#vizgg1"+e);var f=u.defs(r).filter().id("vizgg5"+e).sel();u.defs(f).feFlood().result("flood").floodColor("rgb(0,0,0)").floodOpacity("0.6"),u.defs(f).feComposite().result("composite1").operator("in").in2("SourceGraphic").in("flood"),u.defs(f).feGaussianBlur().result("blur").stdDeviation("2").in("composite1"),u.defs(f).feOffset().result("offset").dy("2").dx("2"),u.defs(f).feComposite().result("composite2").operator("over").in2("offset").in("SourceGraphic");var l=u.defs(r).filter().x("-0.3").y("-0.3").height("1.8").width("1.8").id("vizgg6"+e).sel();u.defs(l).feGaussianBlur().stdDeviation("2")},t.setNeedle=function(n){function e(t,n){return d3.interpolateString("rotate("+t+")","rotate("+n+")")}var r=180*t.scale()(n)/s+90,a=180*t.scale()(t.value())/s+90,i=t.ease();g.selectAll(".needle").data([n]).transition().duration(t.duration()).attrTween("transform",(function(t){return e(a,r)})).ease(i),g.selectAll(".needleshadow").data([n]).transition().duration(t.duration()).attrTween("transform",(function(t){return e(a,r)})).ease(i).each("end",(function(){angle=n})),t.value(n)},t},u.ch=function(){function u(t){function n(t){return r([B,O,t.startAngle,t.endAngle])}function e(t){return a(B,t.startAngle,t.endAngle,B,t.endStartAngle,t.endEndAngle)}p=t,k||f(),t.each((function(){var t=d3.select(this),r=t.selectAll(".groups").data(x).enter().append("g").attr("class","groups").on("mouseover",u.mouseover).on("mouseout",u.mouseout),a=r.append("text").attr("class","label"),i=(1+u.labelPadding())*u.outerRadius(),s=u.valueFormat();a.filter((function(t){return"g"==t.type})).attr("x",(function(t){return i*Math.cos(d(t))})).attr("y",(function(t){return i*Math.sin(d(t))})).text((function(t){return t.source+" ("+s(t.value)+")"})).style("text-anchor",(function(t){var n=d(t);return c>n||n>o-c?"start":"end"})).each((function(t){this._current=t})),r.append("path").style("fill",(function(t){return y(t.source)})).style("stroke",(function(t){return y(t.source)})).attr("d",n).each((function(t){this._current=t})).filter((function(t){return"g"==t.type})),t.append("g").attr("class","chords").selectAll(".chord").data(k).enter().append("g").attr("class","chord").append("path").each((function(t){this._current=t})).attr("d",e).style("fill",(function(t){return y(t.target)})).style("opacity",u.chordOpacity()).style("stroke",(function(t){return y(t.target)})).style("display",(function(t){return t.display?"inline":"none"}))}))}function s(t){var g=p.selectAll(".groups").data(t?b:u.groups()),h=(1+u.labelPadding())*u.outerRadius(),y=u.valueFormat();g.select("path").transition().duration(L).attrTween("d",(function(t){var e=d3.interpolate(this._current,t);return this._current=e(0),function(t){return function(t,n){return r([B,O,t.startAngle,t.endAngle])}(e(t))}})),g.select(".label").filter((function(t){return"g"==t.type})).transition().duration(L).attrTween("x",(function(t){var n=d3.interpolate(this._current,t);return this._current=n(0),function(t){return h*Math.cos(d(n(t)))}})).attrTween("y",(function(t){var n=d3.interpolate(this._current,t);return this._current=n(0),function(t){return h*Math.sin(d(n(t)))}})).text((function(t){return t.source+" ("+y(t.value)+")"})).style("text-anchor",(function(t){var n=d(t);return c>n||n>o-c?"start":"end"}));var m=u.chordOpacity();p.select(".chords").selectAll(".chord").data(t?w:u.chords()).select("path").transition().duration(L).attrTween("d",(function(t){var n=d3.interpolate(this._current,t);return this._current=n(0),function(t){return function(t){return a(B,t.startAngle,t.endAngle,B,t.endStartAngle,t.endEndAngle)}(n(t))}})).style("opacity",(function(t){return t.display?m:0}))}function d(n){return function(t){for(;t>o;)t-=o;for(;0>t;)t+=o;return t}((n.startAngle+n.endAngle)/2)}function f(){m=[],h.forEach((function(t){-1==m.indexOf(E(t))&&m.push(E(t)),-1==m.indexOf(M(t))&&m.push(M(t))})),m=m.sort(T),v={},A={},m.forEach((function(t){v[t]={},A[t]={},m.forEach((function(n){v[t][n]=0,A[t][n]=!1}))})),h.forEach((function(t){var n=E(t),e=M(t);v[n][e]+=S(t),A[n][e]=!0})),x=[],m.forEach((function(t,n){x.push({source:t,type:"gs",value:0,skipPad:!0,index:n}),x.push({source:t,type:"g",value:d3.sum(m,(function(n){return v[t][n]})),skipPad:!1,index:n})})),g(x,z,R,void 0,P),k=[],x.filter((function(t){return"g"==t.type})).forEach((function(t,n){var r=i(m.length,n),a=e(r.map((function(n){return v[t.source][m[n]]})),0,0,t.startAngle,t.endAngle);r.forEach((function(e,r){var i=a[r];k.push({startAngle:i.c-i.v/2,endAngle:i.c+i.v/2,value:i.value,source:t.source,target:m[e],type:"c",display:A[t.source][m[e]],index:n,subindex:e,indexsubindex:n+"-"+e})}))}));var t=d3.map(k,(function(t){return t.indexsubindex}));k.forEach((function(n){if(n.subindex==n.index)return n.endStartAngle=n.startAngle,void(n.endEndAngle=n.startAngle);var e=t.get(n.subindex+"-"+n.index);n.endStartAngle=e.startAngle,n.endEndAngle=e.startAngle})),F=!1}function g(t,e,r,a,i){var u=void 0!==a,o=0;if(u){for(var s=!1;o<t.length;o++)if(t[o].source==a&&"g"==t[o].type){s=!0;break}s||console.log("The fixed source '"+a+"' is not a valid key")}var c=d3.range(t.length);u&&(c=c.slice(o).concat(c.slice(0,o)));var d=t.filter((function(t){return!(u&&t.source===a&&"g"==t.type||t.skipPad)})).map((function(t){return t.value})),f=2*Math.PI-(u?t[o].endAngle-t[o].startAngle+2*e:0),l=u?t[o].endAngle+e:i,g=d3.sum(d),p=n(d,e,r,0>=f?0:f,g,!!u);c.slice(u?1:0).forEach((function(n){var a=p*t[n].value,i=(r>a?r-a:0)/2;t[n].startAngle=l,t[n].endAngle=l+a,t[n].padAngle=i,t[n].percent=t[n].value/(g||1),l+=a+i+(t[n].skipPad?0:e)}))}var p,h,y,m,v,A,x,k,b,w,E=function(t){return t[0]},M=function(t){return t[1]},S=function(t){return t[2]},C=function(t){return t},T=d3.ascending,z=.03,P=0,B=180,O=200,j=.7,G=.02,R=0,L=500,F=!0;return u.data=function(t){return arguments.length?(h=t,F=!0,u):h},u.fill=function(t){return arguments.length?(y=t,u):y},u.duration=function(t){return arguments.length?(L=t,u):L},u.chordOpacity=function(t){return arguments.length?(j=t,u):j},u.innerRadius=function(t){return arguments.length?(B=t,F=!0,u):B},u.outerRadius=function(t){return arguments.length?(O=t,F=!0,u):O},u.source=function(t){return arguments.length?(E=t,F=!0,u):E},u.target=function(t){return arguments.length?(M=t,F=!0,u):M},u.value=function(t){return arguments.length?(S=t,F=!0,u):S},u.padding=function(t){return arguments.length?(z=t,F=!0,u):z},u.labelPadding=function(t){return arguments.length?(G=t,u):G},u.sort=function(t){return arguments.length?(T=t,F=!0,u):T},u.startAngle=function(t){return arguments.length?(P=t,F=!0,u):P},u.chords=function(){return F&&f(),k},u.groups=function(){return F&&f(),x},u.valueFormat=function(t){return arguments.length?(C=t,u):C},u.mouseover=function(t){(function(t){function n(t){return t.endAngle+t.startAngle}var r=x.filter((function(n){return n.source==t&&"g"==n.type}))[0];b=[],m.forEach((function(n,e){b.push({source:n,startAngle:r.startAngle,endAngle:r.endAngle,padAngle:r.padAngle,percent:r.percent,type:"gs",value:n==t?v[n][n]:0,skipPad:n!=t||!A[n][n],index:e}),n==t?b.push({source:n,startAngle:r.startAngle,endAngle:r.endAngle,padAngle:r.padAngle,percent:r.percent,type:"g",value:r.value,skipPad:!1,index:e}):b.push({source:n,type:"g",value:v[t][n],skipPad:!1,index:e})})),g(b,z,R,t,P);var a=n(r);x.forEach((function(t,e){var r=b[e],i=n(t)<a;r.startAngle-=i?o:0,r.endAngle-=i?o:0})),w=[],b.filter((function(t){return"g"==t.type})).forEach((function(n,r){var a=i(m.length,r),u=a.map((function(e){var r=m[e];return n.source==t?v[n.source][r]:r==t?v[r][n.source]:0})),o=e(u,0,0,n.startAngle,n.endAngle);a.forEach((function(e,a){var i=o[a];w.push({startAngle:i.c-i.v/2,endAngle:i.c+i.v/2,value:i.value,source:n.source,target:m[e],type:"c",display:n.source===t,index:r,subindex:e,indexsubindex:r+"-"+e})}))}));var u=d3.map(w.map((function(t){return{startAngle:t.startAngle,endAngle:t.endAngle,indexsubindex:t.indexsubindex}})),(function(t){return t.indexsubindex})),s=d3.map(b.filter((function(t){return"gs"==t.type})),(function(t){return t.source}));w.forEach((function(n){if(n.subindex==n.index){var e=s.get(n.source);return n.endStartAngle=e.startAngle,void(n.endEndAngle=e.endAngle)}var r=u.get(n.subindex+"-"+n.index);n.endStartAngle=r.startAngle,n.endEndAngle=r.endAngle,n.source!==t&&(n.startAngle=n.endAngle,n.endEndAngle=n.endStartAngle)}))})(t.source),s(1)},u.mouseout=function(t){s(0)},u},u.defs=function(t){var n={},e=t;return n.sel=function(){return e},n.lG=function(){return e=e.append("linearGradient"),n},n.rG=function(){return e=e.append("radialGradient"),n},n.stop=function(){return e=e.append("stop"),n},n.filter=function(){return e=e.append("filter"),n},n.feFlood=function(){return e=e.append("feFlood"),n},n.feComposite=function(){return e=e.append("feComposite"),n},n.feOffset=function(){return e=e.append("feOffset"),n},n.feGaussianBlur=function(){return e=e.append("feGaussianBlur"),n},n.result=function(t){return e=e.attr("result",t),n},n.floodColor=function(t){return e=e.attr("flood-color",t),n},n.floodOpacity=function(t){return e=e.attr("flood-opacity",t),n},n.stdDeviation=function(t){return e=e.attr("stdDeviation",t),n},n.operator=function(t){return e=e.attr("operator",t),n},n.height=function(t){return e=e.attr("height",t),n},n.width=function(t){return e=e.attr("width",t),n},n.in=function(t){return e=e.attr("in",t),n},n.in2=function(t){return e=e.attr("in2",t),n},n.id=function(t){return e=e.attr("id",t),n},n.fx=function(t){return e=e.attr("fx",t),n},n.fy=function(t){return e=e.attr("fy",t),n},n.dx=function(t){return e=e.attr("dx",t),n},n.dy=function(t){return e=e.attr("dy",t),n},n.x1=function(t){return e=e.attr("x1",t),n},n.y1=function(t){return e=e.attr("y1",t),n},n.x2=function(t){return e=e.attr("x2",t),n},n.y2=function(t){return e=e.attr("y2",t),n},n.x=function(t){return e=e.attr("x",t),n},n.y=function(t){return e=e.attr("y",t),n},n.r=function(t){return e=e.attr("r",t),n},n.spreadMethod=function(t){return e=e.attr("spreadMethod",t),n},n.gradientUnits=function(t){return e=e.attr("gradientUnits",t),n},n.xlink=function(t){return e=e.attr("xlink:href",t),n},n.offset=function(t){return e=e.attr("offset",t),n},n.stopColor=function(t){return e=e.attr("stop-color",t),n},n.path=function(){return e=e.append("path"),n},n.d=function(t){return e=e.attr("d",t),n},n},this.viz=u}(),
/*!
 * jQuery UI Tabs 1.13.2
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
function(factory){"use strict";"function"==typeof define&&define.amd?define(["jquery","../keycode","../safe-active-element","../unique-id","../version","../widget"],factory):factory(jQuery)}((function($){"use strict";var rhash;return $.widget("ui.tabs",{version:"1.13.2",delay:300,options:{active:null,classes:{"ui-tabs":"ui-corner-all","ui-tabs-nav":"ui-corner-all","ui-tabs-panel":"ui-corner-bottom","ui-tabs-tab":"ui-corner-top"},collapsible:!1,event:"click",heightStyle:"content",hide:null,show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_isLocal:(rhash=/#.*$/,function(anchor){var anchorUrl,locationUrl;anchorUrl=anchor.href.replace(rhash,""),locationUrl=location.href.replace(rhash,"");try{anchorUrl=decodeURIComponent(anchorUrl)}catch(error){}try{locationUrl=decodeURIComponent(locationUrl)}catch(error){}return anchor.hash.length>1&&anchorUrl===locationUrl}),_create:function(){var that=this,options=this.options;this.running=!1,this._addClass("ui-tabs","ui-widget ui-widget-content"),this._toggleClass("ui-tabs-collapsible",null,options.collapsible),this._processTabs(),options.active=this._initialActive(),Array.isArray(options.disabled)&&(options.disabled=$.uniqueSort(options.disabled.concat($.map(this.tabs.filter(".ui-state-disabled"),(function(li){return that.tabs.index(li)})))).sort()),!1!==this.options.active&&this.anchors.length?this.active=this._findActive(options.active):this.active=$(),this._refresh(),this.active.length&&this.load(options.active)},_initialActive:function(){var active=this.options.active,collapsible=this.options.collapsible,locationHash=location.hash.substring(1);return null===active&&(locationHash&&this.tabs.each((function(i,tab){if($(tab).attr("aria-controls")===locationHash)return active=i,!1})),null===active&&(active=this.tabs.index(this.tabs.filter(".ui-tabs-active"))),null!==active&&-1!==active||(active=!!this.tabs.length&&0)),!1!==active&&-1===(active=this.tabs.index(this.tabs.eq(active)))&&(active=!collapsible&&0),!collapsible&&!1===active&&this.anchors.length&&(active=0),active},_getCreateEventData:function(){return{tab:this.active,panel:this.active.length?this._getPanelForTab(this.active):$()}},_tabKeydown:function(event){var focusedTab=$($.ui.safeActiveElement(this.document[0])).closest("li"),selectedIndex=this.tabs.index(focusedTab),goingForward=!0;if(!this._handlePageNav(event)){switch(event.keyCode){case $.ui.keyCode.RIGHT:case $.ui.keyCode.DOWN:selectedIndex++;break;case $.ui.keyCode.UP:case $.ui.keyCode.LEFT:goingForward=!1,selectedIndex--;break;case $.ui.keyCode.END:selectedIndex=this.anchors.length-1;break;case $.ui.keyCode.HOME:selectedIndex=0;break;case $.ui.keyCode.SPACE:return event.preventDefault(),clearTimeout(this.activating),void this._activate(selectedIndex);case $.ui.keyCode.ENTER:return event.preventDefault(),clearTimeout(this.activating),void this._activate(selectedIndex!==this.options.active&&selectedIndex);default:return}event.preventDefault(),clearTimeout(this.activating),selectedIndex=this._focusNextTab(selectedIndex,goingForward),event.ctrlKey||event.metaKey||(focusedTab.attr("aria-selected","false"),this.tabs.eq(selectedIndex).attr("aria-selected","true"),this.activating=this._delay((function(){this.option("active",selectedIndex)}),this.delay))}},_panelKeydown:function(event){this._handlePageNav(event)||event.ctrlKey&&event.keyCode===$.ui.keyCode.UP&&(event.preventDefault(),this.active.trigger("focus"))},_handlePageNav:function(event){return event.altKey&&event.keyCode===$.ui.keyCode.PAGE_UP?(this._activate(this._focusNextTab(this.options.active-1,!1)),!0):event.altKey&&event.keyCode===$.ui.keyCode.PAGE_DOWN?(this._activate(this._focusNextTab(this.options.active+1,!0)),!0):void 0},_findNextTab:function(index,goingForward){var lastTabIndex=this.tabs.length-1;for(;-1!==$.inArray((index>lastTabIndex&&(index=0),index<0&&(index=lastTabIndex),index),this.options.disabled);)index=goingForward?index+1:index-1;return index},_focusNextTab:function(index,goingForward){return index=this._findNextTab(index,goingForward),this.tabs.eq(index).trigger("focus"),index},_setOption:function(key,value){"active"!==key?(this._super(key,value),"collapsible"===key&&(this._toggleClass("ui-tabs-collapsible",null,value),value||!1!==this.options.active||this._activate(0)),"event"===key&&this._setupEvents(value),"heightStyle"===key&&this._setupHeightStyle(value)):this._activate(value)},_sanitizeSelector:function(hash){return hash?hash.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):""},refresh:function(){var options=this.options,lis=this.tablist.children(":has(a[href])");options.disabled=$.map(lis.filter(".ui-state-disabled"),(function(tab){return lis.index(tab)})),this._processTabs(),!1!==options.active&&this.anchors.length?this.active.length&&!$.contains(this.tablist[0],this.active[0])?this.tabs.length===options.disabled.length?(options.active=!1,this.active=$()):this._activate(this._findNextTab(Math.max(0,options.active-1),!1)):options.active=this.tabs.index(this.active):(options.active=!1,this.active=$()),this._refresh()},_refresh:function(){this._setOptionDisabled(this.options.disabled),this._setupEvents(this.options.event),this._setupHeightStyle(this.options.heightStyle),this.tabs.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}),this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-hidden":"true"}),this.active.length?(this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}),this._addClass(this.active,"ui-tabs-active","ui-state-active"),this._getPanelForTab(this.active).show().attr({"aria-hidden":"false"})):this.tabs.eq(0).attr("tabIndex",0)},_processTabs:function(){var that=this,prevTabs=this.tabs,prevAnchors=this.anchors,prevPanels=this.panels;this.tablist=this._getList().attr("role","tablist"),this._addClass(this.tablist,"ui-tabs-nav","ui-helper-reset ui-helper-clearfix ui-widget-header"),this.tablist.on("mousedown"+this.eventNamespace,"> li",(function(event){$(this).is(".ui-state-disabled")&&event.preventDefault()})).on("focus"+this.eventNamespace,".ui-tabs-anchor",(function(){$(this).closest("li").is(".ui-state-disabled")&&this.blur()})),this.tabs=this.tablist.find("> li:has(a[href])").attr({role:"tab",tabIndex:-1}),this._addClass(this.tabs,"ui-tabs-tab","ui-state-default"),this.anchors=this.tabs.map((function(){return $("a",this)[0]})).attr({tabIndex:-1}),this._addClass(this.anchors,"ui-tabs-anchor"),this.panels=$(),this.anchors.each((function(i,anchor){var selector,panel,panelId,anchorId=$(anchor).uniqueId().attr("id"),tab=$(anchor).closest("li"),originalAriaControls=tab.attr("aria-controls");that._isLocal(anchor)?(panelId=(selector=anchor.hash).substring(1),panel=that.element.find(that._sanitizeSelector(selector))):(selector="#"+(panelId=tab.attr("aria-controls")||$({}).uniqueId()[0].id),(panel=that.element.find(selector)).length||(panel=that._createPanel(panelId)).insertAfter(that.panels[i-1]||that.tablist),panel.attr("aria-live","polite")),panel.length&&(that.panels=that.panels.add(panel)),originalAriaControls&&tab.data("ui-tabs-aria-controls",originalAriaControls),tab.attr({"aria-controls":panelId,"aria-labelledby":anchorId}),panel.attr("aria-labelledby",anchorId)})),this.panels.attr("role","tabpanel"),this._addClass(this.panels,"ui-tabs-panel","ui-widget-content"),prevTabs&&(this._off(prevTabs.not(this.tabs)),this._off(prevAnchors.not(this.anchors)),this._off(prevPanels.not(this.panels)))},_getList:function(){return this.tablist||this.element.find("ol, ul").eq(0)},_createPanel:function(id){return $("<div>").attr("id",id).data("ui-tabs-destroy",!0)},_setOptionDisabled:function(disabled){var currentItem,li,i;for(Array.isArray(disabled)&&(disabled.length?disabled.length===this.anchors.length&&(disabled=!0):disabled=!1),i=0;li=this.tabs[i];i++)currentItem=$(li),!0===disabled||-1!==$.inArray(i,disabled)?(currentItem.attr("aria-disabled","true"),this._addClass(currentItem,null,"ui-state-disabled")):(currentItem.removeAttr("aria-disabled"),this._removeClass(currentItem,null,"ui-state-disabled"));this.options.disabled=disabled,this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,!0===disabled)},_setupEvents:function(event){var events={};event&&$.each(event.split(" "),(function(index,eventName){events[eventName]="_eventHandler"})),this._off(this.anchors.add(this.tabs).add(this.panels)),this._on(!0,this.anchors,{click:function(event){event.preventDefault()}}),this._on(this.anchors,events),this._on(this.tabs,{keydown:"_tabKeydown"}),this._on(this.panels,{keydown:"_panelKeydown"}),this._focusable(this.tabs),this._hoverable(this.tabs)},_setupHeightStyle:function(heightStyle){var maxHeight,parent=this.element.parent();"fill"===heightStyle?(maxHeight=parent.height(),maxHeight-=this.element.outerHeight()-this.element.height(),this.element.siblings(":visible").each((function(){var elem=$(this),position=elem.css("position");"absolute"!==position&&"fixed"!==position&&(maxHeight-=elem.outerHeight(!0))})),this.element.children().not(this.panels).each((function(){maxHeight-=$(this).outerHeight(!0)})),this.panels.each((function(){$(this).height(Math.max(0,maxHeight-$(this).innerHeight()+$(this).height()))})).css("overflow","auto")):"auto"===heightStyle&&(maxHeight=0,this.panels.each((function(){maxHeight=Math.max(maxHeight,$(this).height("").height())})).height(maxHeight))},_eventHandler:function(event){var options=this.options,active=this.active,tab=$(event.currentTarget).closest("li"),clickedIsActive=tab[0]===active[0],collapsing=clickedIsActive&&options.collapsible,toShow=collapsing?$():this._getPanelForTab(tab),toHide=active.length?this._getPanelForTab(active):$(),eventData={oldTab:active,oldPanel:toHide,newTab:collapsing?$():tab,newPanel:toShow};event.preventDefault(),tab.hasClass("ui-state-disabled")||tab.hasClass("ui-tabs-loading")||this.running||clickedIsActive&&!options.collapsible||!1===this._trigger("beforeActivate",event,eventData)||(options.active=!collapsing&&this.tabs.index(tab),this.active=clickedIsActive?$():tab,this.xhr&&this.xhr.abort(),toHide.length||toShow.length||$.error("jQuery UI Tabs: Mismatching fragment identifier."),toShow.length&&this.load(this.tabs.index(tab),event),this._toggle(event,eventData))},_toggle:function(event,eventData){var that=this,toShow=eventData.newPanel,toHide=eventData.oldPanel;function complete(){that.running=!1,that._trigger("activate",event,eventData)}function show(){that._addClass(eventData.newTab.closest("li"),"ui-tabs-active","ui-state-active"),toShow.length&&that.options.show?that._show(toShow,that.options.show,complete):(toShow.css("display","block"),complete())}this.running=!0,toHide.length&&this.options.hide?this._hide(toHide,this.options.hide,(function(){that._removeClass(eventData.oldTab.closest("li"),"ui-tabs-active","ui-state-active"),show()})):(this._removeClass(eventData.oldTab.closest("li"),"ui-tabs-active","ui-state-active"),toHide.css("display","none"),show()),toHide.attr("aria-hidden","true"),eventData.oldTab.attr({"aria-selected":"false","aria-expanded":"false"}),toShow.length&&toHide.length?eventData.oldTab.attr("tabIndex",-1):toShow.length&&this.tabs.filter((function(){return 0===$(this).attr("tabIndex")})).attr("tabIndex",-1),toShow.attr("aria-hidden","false"),eventData.newTab.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0})},_activate:function(index){var anchor,active=this._findActive(index);active[0]!==this.active[0]&&(active.length||(active=this.active),anchor=active.find(".ui-tabs-anchor")[0],this._eventHandler({target:anchor,currentTarget:anchor,preventDefault:$.noop}))},_findActive:function(index){return!1===index?$():this.tabs.eq(index)},_getIndex:function(index){return"string"==typeof index&&(index=this.anchors.index(this.anchors.filter("[href$='"+$.escapeSelector(index)+"']"))),index},_destroy:function(){this.xhr&&this.xhr.abort(),this.tablist.removeAttr("role").off(this.eventNamespace),this.anchors.removeAttr("role tabIndex").removeUniqueId(),this.tabs.add(this.panels).each((function(){$.data(this,"ui-tabs-destroy")?$(this).remove():$(this).removeAttr("role tabIndex aria-live aria-busy aria-selected aria-labelledby aria-hidden aria-expanded")})),this.tabs.each((function(){var li=$(this),prev=li.data("ui-tabs-aria-controls");prev?li.attr("aria-controls",prev).removeData("ui-tabs-aria-controls"):li.removeAttr("aria-controls")})),this.panels.show(),"content"!==this.options.heightStyle&&this.panels.css("height","")},enable:function(index){var disabled=this.options.disabled;!1!==disabled&&(void 0===index?disabled=!1:(index=this._getIndex(index),disabled=Array.isArray(disabled)?$.map(disabled,(function(num){return num!==index?num:null})):$.map(this.tabs,(function(li,num){return num!==index?num:null}))),this._setOptionDisabled(disabled))},disable:function(index){var disabled=this.options.disabled;if(!0!==disabled){if(void 0===index)disabled=!0;else{if(index=this._getIndex(index),-1!==$.inArray(index,disabled))return;disabled=Array.isArray(disabled)?$.merge([index],disabled).sort():[index]}this._setOptionDisabled(disabled)}},load:function(index,event){index=this._getIndex(index);var that=this,tab=this.tabs.eq(index),anchor=tab.find(".ui-tabs-anchor"),panel=this._getPanelForTab(tab),eventData={tab:tab,panel:panel},complete=function(jqXHR,status){"abort"===status&&that.panels.stop(!1,!0),that._removeClass(tab,"ui-tabs-loading"),panel.removeAttr("aria-busy"),jqXHR===that.xhr&&delete that.xhr};this._isLocal(anchor[0])||(this.xhr=$.ajax(this._ajaxSettings(anchor,event,eventData)),this.xhr&&"canceled"!==this.xhr.statusText&&(this._addClass(tab,"ui-tabs-loading"),panel.attr("aria-busy","true"),this.xhr.done((function(response,status,jqXHR){setTimeout((function(){panel.html(response),that._trigger("load",event,eventData),complete(jqXHR,status)}),1)})).fail((function(jqXHR,status){setTimeout((function(){complete(jqXHR,status)}),1)}))))},_ajaxSettings:function(anchor,event,eventData){var that=this;return{url:anchor.attr("href").replace(/#.*$/,""),beforeSend:function(jqXHR,settings){return that._trigger("beforeLoad",event,$.extend({jqXHR:jqXHR,ajaxSettings:settings},eventData))}}},_getPanelForTab:function(tab){var id=$(tab).attr("aria-controls");return this.element.find(this._sanitizeSelector("#"+id))}}),!1!==$.uiBackCompat&&$.widget("ui.tabs",$.ui.tabs,{_processTabs:function(){this._superApply(arguments),this._addClass(this.tabs,"ui-tab")}}),$.ui.tabs}));"use strict";fluid.registerNamespace("fluid.colour"),fluid.colour.hexIndirect={3:"001122",4:"00112233",6:"012345",8:"01234567"},fluid.colour.hexToArray=function(hex){"#"!==hex.charAt(0)&&fluid.fail("hex colour must begin with # - "+hex),hex=hex.substring(1);const digits=fluid.transform(hex.split(""),(function(ch){return parseInt(ch,16)})),indirect=fluid.colour.hexIndirect[hex.length];indirect||fluid.fail("Unsupported number of hex digits in "+hex+": can only supply "+Object.keys(fluid.colour.hexIndirect).join(", ")+" digits");const array=[];for(let i=0;i<indirect.length;i+=2){const colour=(16*digits[indirect[i]]+digits[indirect[i+1]])/(6===i?255:1);array.push(colour)}return array},fluid.colour.arrayToString=function(array){return(3===array.length?"rgb(":"rgba(")+array.join(", ")+")"},fluid.colour.interpolate=function(f,c1,c2){return fluid.transform([(1-f)*c1[0]+f*c2[0],(1-f)*c1[1]+f*c2[1],(1-f)*c1[2]+f*c2[2]],Math.round)},fluid.colour.interpolateStops=function(stops,value){const binIndex=stops.findIndex((stop=>value<=stop[0])),bin=stops[binIndex];if(-1===binIndex)return stops[stops.length-1][1];if(0===binIndex)return bin[1];const lowerStop=stops[binIndex-1],upperStop=bin,t=(value-lowerStop[0])/(upperStop[0]-lowerStop[0]),interpolatedColor=fluid.colour.interpolate(t,fluid.colour.hexToArray(lowerStop[1]),fluid.colour.hexToArray(upperStop[1]));return fluid.colour.arrayToString(interpolatedColor)},fluid.colour.memoStops=function(stops,steps){const colours=[];for(let i=0;i<=steps;++i)colours.push(fluid.colour.interpolateStops(stops,i/steps));return colours},fluid.colour.lookupStop=function(steps,prop){return steps[Math.floor(prop*(steps.length-1))]},fluid.colour.average=function(ca){return ca.reduce((function(total,c){return total[0]+=c[0],total[1]+=c[1],total[2]+=c[2],total}),[0,0,0]).map((function(e){return e/ca.length}))},fluid.colour.rgbToHsl=function(c){const r=c[0]/255,g=c[1]/255,b=c[2]/255,max=Math.max(r,g,b),min=Math.min(r,g,b);let h,s,l=(max+min)/2;if(max===min)h=s=0;else{const d=max-min;s=l>.5?d/(2-max-min):d/(max+min),h=max===r?(g-b)/d+(g<b?6:0):max===g?(b-r)/d+2:(r-g)/d+4,h/=6}return[h,s,l]},fluid.colour.hue2rgb=function(p,q,t){return t<0?t+=1:t>1&&(t-=1),t<1/6?p+6*(q-p)*t:t<.5?q:t<2/3?p+(q-p)*(2/3-t)*6:p},fluid.colour.hslToRgb=function(hsl){const h=hsl[0],s=hsl[1],l=hsl[2];let r,g,b;if(0===s)r=g=b=l;else{const q=l<.5?l*(1+s):l+s-l*s,p=2*l-q;r=fluid.colour.hue2rgb(p,q,h+1/3),g=fluid.colour.hue2rgb(p,q,h),b=fluid.colour.hue2rgb(p,q,h-1/3)}return[Math.round(255*r),Math.round(255*g),Math.round(255*b)]},(hortis=fluid.registerNamespace("hortis")).encodeHTML=function(str){return str.replace(/[&<>'"]/g,(function(tag){return{"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"}[tag]}))},hortis.renderSVGElement=function(markup,parentContainer){const element=$.parseXML(markup).documentElement;return parentContainer.append(element),element},hortis.renderNumber=function(number){return Math.abs(number)<1e-5?"0":number.toFixed(3)},hortis.emitPath=function(elements){let togo="";return elements.forEach((function(elem){togo+="string"==typeof elem?elem:hortis.renderNumber(elem)})),togo},hortis.circularPath=function(radius){const r=radius;return hortis.emitPath(["M",-r," ",0,"A",r," ",r," 0 1 0 ",r," ",0,"A",r," ",r," 0 1 0 ",-r," ",0])},hortis.annularPath=function(innerRadius,outerRadius){const ir=innerRadius,or=outerRadius;return hortis.emitPath(["M",-or," ",0,"A",or," ",or," 0 1 0 ",or," ",0,"A",or," ",or," 0 1 0 ",-or," ",0,"Z","M",-ir," ",0,"A",ir," ",ir," 0 1 1 ",ir," ",0,"A",ir," ",ir," 0 1 1 ",-ir," ",0,"Z"])},hortis.segmentPath=function(startAngle,endAngle,innerRadius,outerRadius){const cs=Math.cos(startAngle),ss=-Math.sin(startAngle),ce=Math.cos(endAngle),se=-Math.sin(endAngle),i=innerRadius,o=outerRadius,lfa=(+(endAngle-startAngle>=Math.PI)).toString();return hortis.emitPath(["M",cs*i," ",ss*i,"A",i," ",i," 0 ",lfa," 0 ",ce*i," ",se*i,"L",ce*o," ",se*o,"A",o," ",o," 0 ",lfa," 1 ",cs*o," ",ss*o,"Z"])},hortis.linearTextPath=function(leftAngle,rightAngle,innerRadius,outerRadius){const midAngle=(leftAngle+rightAngle)/2,c=Math.cos(midAngle),s=-Math.sin(midAngle),sr=c>0?innerRadius:outerRadius,fr=c>0?outerRadius:innerRadius;return hortis.emitPath(["M",c*sr," ",s*sr,"L",c*fr," ",s*fr])},hortis.segmentTextPath=function(startAngle,endAngle,outerRadius){const cs=Math.cos(startAngle),ss=-Math.sin(startAngle),ce=Math.cos(endAngle),se=-Math.sin(endAngle),ar=outerRadius-20,lfa=(+(endAngle-startAngle>=Math.PI)).toString();return hortis.emitPath(["M",cs*ar," ",ss*ar,"A",ar," ",ar," 0 ",lfa," 0 ",ce*ar," ",se*ar])},hortis.circularTextPath=function(outerRadius){const ar=outerRadius-20;return hortis.emitPath(["M","-0.1 ",-ar,"A",ar," ",ar," 0 1 0 ","0.1 ",-ar])};var{signal:signal,effect:effect,computed:computed}=preactSignalsCore;fluid.coerceToPrimitive=function(string){return/^(true|false|null)$/.test(string)||/^[\[{0-9]/.test(string)&&!/^{\w/.test(string)?JSON.parse(string):string},fluid.processSignalArgs=function(args){let undefinedSignals=!1;const designalArgs=[];for(const arg of args)if(arg instanceof preactSignalsCore.Signal){const value=arg.value;designalArgs.push(arg.value),void 0===value&&(undefinedSignals=!0)}else designalArgs.push(arg);return{designalArgs:designalArgs,undefinedSignals:undefinedSignals}},fluid.computed=function(func,...args){return computed((()=>{const{designalArgs:designalArgs,undefinedSignals:undefinedSignals}=fluid.processSignalArgs(args);return undefinedSignals?void 0:"string"==typeof func?fluid.invokeGlobalFunction(func,designalArgs):func.apply(null,designalArgs)}))},fluid.effect=function(func,...args){return effect((()=>{const{designalArgs:designalArgs,undefinedSignals:undefinedSignals}=fluid.processSignalArgs(args);if(!undefinedSignals)return"string"==typeof func?fluid.invokeGlobalFunction(func,designalArgs):func.apply(null,designalArgs)}))},fluid.derefSignal=function(signal,path){return computed((()=>{const value=signal.value;return fluid.get(value,path)}))},fluid.validateContainer=function(container){if(!container||!container.jquery||1!==container.length){const selector=container?.selector,count=void 0!==container.length?container.length:0,extraMessages=container.selectorName?[" with selector name "+container.selectorName+" in context ",container.context]:[];fluid.fail((count>1?"More than one ("+count+") container elements were":"No container element was")+" found for selector "+selector,...extraMessages)}return container[0]},fluid.parseMarkup=function(template,hasRoot){const fragment=document.createRange().createContextualFragment(template);return hasRoot?fragment.firstElementChild:fragment},fluid.spliceContainer=function(target,source,elideParent){const children=elideParent?source.childNodes:[source];target.replaceChildren(...children),elideParent&&target.classList.add(...source.classList)},fluid.renderContainerSplice=function(parentContainer,elideParent,hasRoot,renderMarkup){const resolvedContainer=fluid.validateContainer(parentContainer);return effect((()=>{const containerMarkup=renderMarkup(),template=fluid.parseMarkup(containerMarkup,!0);fluid.spliceContainer(resolvedContainer,template,elideParent)})),parentContainer},fluid.renderStringTemplate=function(markup,renderModelSignal){const renderModel=renderModelSignal.value;return void 0===renderModel?markup.fallbackContainer:fluid.stringTemplate(markup.container,renderModel)},fluid.defaults("fluid.stringTemplateRenderingView",{gradeNames:"fluid.containerRenderingView",markup:{fallbackContainer:"<div></div>"},invokers:{renderMarkup:"fluid.renderStringTemplate({that}.options.markup, {that}.renderModel)",renderContainer:"fluid.renderContainerSplice({that}.options.parentContainer, {that}.options.elideParent, {that}.options.hasRoot, {that}.renderMarkup)",addToParent:null},elideParent:!0,hasRoot:!0,members:{renderModel:"@expand:fluid.computed(fluid.blankRenderModel)"}}),fluid.blankRenderModel=function(){return signal(!0).value};var hortis=fluid.registerNamespace("hortis"),{effect:effect,computed:computed,batch:batch}=preactSignalsCore;fluid.defaults("hortis.bareResourceLoader",{gradeNames:"fluid.component",members:{completionPromise:"@expand:fluid.promise()"}}),fluid.defaults("hortis.csvReader",{gradeNames:"hortis.bareResourceLoader",csvOptions:{header:!0,skipEmptyLines:!0},members:{rows:"@expand:signal()"},events:{},listeners:{"onCreate.parse":"hortis.csvReader.parse({that}, {that}.options.csvOptions, {that}.options.url)"}}),Object.defineProperty(fluid,"log",{get:function(){return fluid.isLogging()?console.log.bind(window.console,fluid.renderTimestamp(new Date)+":  "):function(){}}}),hortis.toggleClass=function(container,clazz,value,inverse){container.classList[value^inverse?"add":"remove"](clazz)},hortis.csvReader.parse=function(that,csvOptions,url){const options={...csvOptions,complete:function(results){that.parsed=results,that.data=results.data,that.headers=results.meta.fields,that.completionPromise.resolve(that.data),that.rows.value=that.data},error:function(err){that.completionPromise.reject(),fluid.fail("Error parsing CSV file ",url,": ",err)}};Papa.parse(url,options)},fluid.defaults("hortis.urlCsvReader",{gradeNames:"hortis.csvReader",csvOptions:{download:!0}}),fluid.defaults("hortis.vizLoader",{gradeNames:["fluid.component"],components:{taxaLoader:{type:"hortis.urlCsvReader",options:{url:"{vizLoader}.options.taxaFile"}},obsLoader:{type:"hortis.urlCsvReader",options:{url:"{vizLoader}.options.obsFile"}},taxa:{type:"hortis.taxa",options:{members:{rows:"{vizLoader}.taxaRows"}}}},events:{onResourcesLoaded:null},members:{resourcesLoaded:"@expand:signal()",taxaRows:"@expand:signal()",obsRows:"@expand:signal()",filteredObs:"{that}.obsRows",finalFilteredObs:"@expand:fluid.computed({that}.filterObsByTaxa, {that}.filteredObs)"},invokers:{filterObs:fluid.identity,filterObsByTaxa:fluid.identity},listeners:{"onCreate.bindResources":"hortis.vizLoader.bindResources"}}),hortis.vizLoader.bindResources=async function(that){const promises=fluid.queryIoCSelector(that,"hortis.bareResourceLoader",!0).map((resourceLoader=>resourceLoader.completionPromise)),[taxa,obs]=await Promise.all(promises);batch((()=>{that.taxaRows.value=taxa,that.obsRows.value=obs,that.resourcesLoaded.value=!0,that.events.onResourcesLoaded.fire()}))},fluid.defaults("hortis.filter",{members:{filterInput:null,filterOutput:null},invokers:{}}),fluid.defaults("hortis.filters",{listeners:{"onCreate.wireFilters":"hortis.wireObsFilters"},members:{allInput:"{vizLoader}.obsRows",allOutput:"@expand:signal()"}}),hortis.wireObsFilters=function(that){const filterComps=fluid.queryIoCSelector(that,"hortis.filter",!0);let prevOutput=that.allInput;filterComps.forEach((filterComp=>{filterComp.filterInput=prevOutput,filterComp.filterOutput=fluid.computed(filterComp.doFilter,filterComp.filterInput,filterComp.filterState),prevOutput=filterComp.filterOutput})),effect((()=>that.allOutput.value=prevOutput.value))},hortis.rowCheckbox=function(rowid){return`\n    <span class="pretty p-icon">\n      <input type="checkbox" class="checklist-check" ${rowid}/>\n      <span class="state p-success">\n        <i class="icon mdi mdi-check"></i>\n        <label></label>\n      </span>\n    </span>`},hortis.taxonTooltipTemplate='<div class="imerss-tooltip">\n    <div class="imerss-photo" style="background-image: url(%imgUrl)"></div>\n    <div class="text"><b>%taxonRank:</b> %taxonNames</div>\n</div>',hortis.capitalize=function(string){return string.charAt(0).toUpperCase()+string.slice(1)},hortis.renderTaxonTooltip=function(that,hoverId){const row=that.rowById.value[hoverId],terms={imgUrl:row.iNaturalistTaxonImage||""};row.rank?terms.taxonRank=hortis.capitalize(row.rank):terms.taxonRank="Species";const names=[row.taxonName||row.iNaturalistTaxonName,row.commonName,row.hulqName].filter((name=>name));return terms.taxonNames=names.join(" / "),fluid.stringTemplate(hortis.taxonTooltipTemplate,terms)},hortis.isInDocument=function(node){const dokkument=fluid.getDocument(node),container=node[0];return $.contains(dokkument,container)||dokkument===container},hortis.clearAllTooltips=function(that){hortis.clearTooltip(that),$(".ui-tooltip").remove(),that[that.options.tooltipKey].value=null},hortis.clearTooltip=function(that){const tooltipTarget=that.tooltipTarget;tooltipTarget&&(that.tooltipTarget=null,hortis.isInDocument(tooltipTarget)?tooltipTarget.tooltip("destroy"):hortis.clearAllTooltips(that))},hortis.updateTooltip=function(that,id){const content=id?that.renderTooltip(id):null;if(hortis.clearTooltip(that),content){const target=$(that.hoverEvent.target);target.tooltip({items:target}),target.tooltip("option","content",content||""),target.tooltip("option","track",!0),target.tooltip("open",that.hoverEvent),that.tooltipTarget=target}else that.hoverEvent=null},hortis.subscribeHover=function(that){const tooltipKey=that.options.tooltipKey;return effect((()=>{hortis.updateTooltip(that,that[tooltipKey].value)}))},fluid.defaults("hortis.checkbox",{gradeNames:"fluid.stringTemplateRenderingView",members:{value:"@expand:signal()",valueToDom:"@expand:fluid.effect(hortis.checkbox.valueToDom, {that}.value, {that}.dom.control.0)"},selectors:{control:"input"},elideParent:!1,markup:{container:'\n        <span class="pretty p-icon">\n            <input type="checkbox" class="checklist-check"/>\n            <span class="state p-success">\n                <i class="icon mdi mdi-check"></i>\n                <label></label>\n            </span>\n        </span>'},listeners:{"onCreate.listenCheck":"hortis.checkbox.listenCheck"}}),hortis.checkbox.valueToDom=function(value,node){const state=value?hortis.SELECTED:hortis.UNSELECTED;node.checked=state===hortis.SELECTED,node.indeterminate=state===hortis.INDETERMINATE;const ui=node.closest(".p-icon").querySelector(".icon");$(ui).toggleClass("mdi-check",state!==hortis.INDETERMINATE)},hortis.checkbox.listenCheck=function(that){that.dom.locate("control").on("click",(function(){that.value.value=this.checked}))},hortis.closeParentTaxa=function(rowFocus,rowById){return Object.keys(rowFocus).forEach((function(id){let row=rowById[id];for(;row;)rowFocus[row.id]=!0,row=row.parent})),rowFocus},hortis.taxaFromObs=function(filteredObs,rowById){const taxonIds={};return filteredObs.forEach((row=>{taxonIds[row["iNaturalist taxon ID"]]=!0})),hortis.closeParentTaxa(taxonIds,rowById)},hortis.bindTaxonHover=function(that,layoutHolder){const hoverable=that.options.selectors.hoverable;that.container.on("mouseenter",hoverable,(function(e){const id=this.dataset.rowId;layoutHolder.hoverEvent=e,layoutHolder.hoverId.value=id})),that.container.on("mouseleave",hoverable,(function(){layoutHolder.hoverId.value=null})),that.container.on("click",hoverable,(function(){const id=this.dataset.rowId;layoutHolder.events.taxonSelect.fire(id)}))},fluid.defaults("hortis.taxa",{gradeNames:"fluid.component",members:{rowByIdPre:"@expand:fluid.computed(hortis.indexTree, {that}.rows)",rowById:"@expand:fluid.computed(hortis.taxa.map, {that}.rows, {that}.rowByIdPre)",entries:"@expand:fluid.computed(hortis.computeEntries, {that}.rows, {that}.acceptRow)",entryById:"@expand:fluid.computed(hortis.indexEntries, {that}.entries)"},invokers:{acceptRow:"hortis.acceptRow({that}, {arguments}.0)"}}),hortis.acceptRow=function(){return!0},hortis.computeEntries=function(rows,acceptRow){const togo=[];return fluid.each(rows,(function(row){if(acceptRow(row))togo.push({row:row,children:hortis.computeEntries(row.children,acceptRow)});else{const dChildren=hortis.computeEntries(row.children,acceptRow);Array.prototype.push.apply(togo,dChildren)}})),hortis.sortChecklistLevel(togo)},hortis.indexEntries=function(entries){const index={};return entries.forEach((function(entry){index[entry.row.id]=entry})),index},hortis.indexTree=function(flatTree){const index={};return flatTree.forEach((function(row){index[row.id]=row})),index},hortis.taxa.map=function(rows,byId){rows.forEach(((row,i)=>{if(row.flatIndex=i,row.children||(row.children=[]),row.parentId){const parent=byId[row.parentId];row.parent=parent,fluid.pushArray(parent,"children",row)}}));const assignDepth=function(node,depth){node.depth=depth,node.children.forEach((child=>assignDepth(child,depth+1)))};return rows.length>0&&assignDepth(rows[0],0),byId},fluid.defaults("hortis.layoutHolder",{gradeNames:"fluid.modelComponent",tooltipKey:"hoverId",events:{taxonSelect:null},members:{taxonHistory:"@expand:signal([])",historyIndex:"@expand:signal(0)",rootId:"@expand:signal({that}.options.rootId)",rowFocus:"@expand:signal({})",rowSelection:"@expand:signal({})",selectedId:"@expand:signal(null)",hoverId:"@expand:signal(null)",subscribeHover:"@expand:hortis.subscribeHover({that})"},modelRelay:{isAtRoot:{target:"isAtRoot",args:["{that}.model.layoutId","{that}.options.rootId"],func:(x,y)=>x===y}},invokers:{renderTooltip:"hortis.renderTaxonTooltip({that}, {arguments}.0)"}}),fluid.defaults("hortis.vizLoaderWithMap",{gradeNames:["fluid.viewComponent","hortis.vizLoader"],selectors:{map:".imerss-map"},components:{map:{type:"hortis.libreMap",container:"{that}.dom.map",options:{gradeNames:"{vizLoader}.options.mapGrades"}}}}),hortis.projectBounds={Galiano:[[48.855,-123.65],[49.005,-123.25]],Valdes:[[49,-123.798],[49.144,-123.504]],Xetthecum:[[48.93713,-123.511],[48.9511,-123.498]],Pepiowelh:[[48.565,-123.1575],[48.598,-123.1266]],HoweSound:[[49.16,-124.281],[50.17,-122.05]],SalishSea:[[47.568,-124.2],[49.134,-122.059]]},hortis.initBounds=function(){return[[90,180],[-90,-180]]},hortis.updateBounds=function(bounds,lat,long){bounds[0][0]=Math.min(bounds[0][0],lat),bounds[0][1]=Math.min(bounds[0][1],long),bounds[1][0]=Math.max(bounds[1][0],lat),bounds[1][1]=Math.max(bounds[1][1],long)},hortis.expandBounds=function(bounds,factor){const width=bounds[1][1]-bounds[0][1],he=width*factor,ve=(bounds[1][0]-bounds[0][0])*factor;width<360&&(bounds[0][0]-=ve,bounds[0][1]-=he,bounds[1][0]+=ve,bounds[1][1]+=he)},fluid.defaults("hortis.libreMap",{gradeNames:"fluid.viewComponent",zoomDuration:1e3,mapOptions:{style:{version:8,layers:[],sources:{}}},members:{map:"@expand:hortis.libreMap.make({that}.container.0, {that}.options.mapOptions, {that}.mapLoaded)",mapLoaded:"@expand:signal()"}}),fluid.defaults("hortis.libreMap.withTiles",{addTiles:"@expand:fluid.effect(hortis.libreMap.addTileLayers, {that}.map, {that}.options.tileSets, {that}.mapLoaded)"}),hortis.libreMap.make=function(container,mapOptions,mapLoaded){const togo=new maplibregl.Map({container:container,...mapOptions});return togo.on("load",(function(){console.log("Map loaded"),mapLoaded.value=1})),togo},fluid.defaults("hortis.libreMap.streetmapTiles",{tileSets:{baseMap:{tiles:["https://tile.openstreetmap.org/{z}/{x}/{y}.png"],attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',tileSize:256}}}),fluid.defaults("hortis.libreMap.usEcoL3Tiles",{tileSets:{ecoL3:{tiles:["https://usda-nifa-b-team.github.io/b-team/tiles/us_eco_l3_tiles/{z}/{x}/{y}.png"],tileSize:512,maxzoom:8,paint:{"raster-opacity":.5}}}}),hortis.libreMap.addTileLayers=function(map,tileSets){Object.keys(tileSets).reverse().forEach((function(key){const tileSet=tileSets[key],paint=tileSet.paint||{};map.addSource(key,{type:"raster",...fluid.censorKeys(tileSet,["paint"])}),map.addLayer({id:key,type:"raster",source:key,paint:paint})}))},hortis.libreMap.viridisStops=[[0,"#440154"],[.2,"#414487"],[.4,"#2a788e"],[.6,"#22a884"],[.8,"#7ad151"],[1,"#fde725"]],hortis.libreMap.natureStops=[[0,"#ffffff"],[1,"#09326d"]],fluid.defaults("hortis.libreMap.withObsGrid",{fillStops:hortis.libreMap.viridisStops,fillOpacity:.7,outlineColour:"black",members:{gridBounds:"@expand:fluid.derefSignal({obsQuantiser}.grid, bounds)",updateObsGrid:"@expand:fluid.effect(hortis.libreMap.updateObsGrid, {that}, {obsQuantiser}, {obsQuantiser}.grid, {that}.mapLoaded)",fitBounds:"@expand:fluid.effect(hortis.libreMap.fitBounds, {that}, {that}.gridBounds, {that}.mapLoaded)"}}),hortis.libreMap.rectFromCorner=function(lat,long,latres,longres){return[[long,lat],[long+longres,lat],[long+longres,lat+latres],[long,lat+latres],[long,lat]]},hortis.libreMap.obsGridFeature=function(map,obsQuantiser,grid){const buckets=grid.buckets,latres=obsQuantiser.latResolution.value,longres=obsQuantiser.longResolution.value;return{type:"FeatureCollection",features:Object.entries(buckets).map((function([key,bucket]){const[lat,long]=hortis.obsQuantiser.indexToCoord(key,latres,longres);return{type:"Feature",geometry:{type:"Polygon",coordinates:[hortis.libreMap.rectFromCorner(lat,long,latres,longres)]},properties:{obsprop:bucket.count/grid.maxCount}}}))}},hortis.libreMap.updateObsGrid=function(map,obsQuantiser,grid){const geojson=hortis.libreMap.obsGridFeature(map,obsQuantiser,grid);let source=map.map.getSource("obsgrid-source");source?source.setData(geojson):map.map.addSource("obsgrid-source",{type:"geojson",data:geojson});if(!map.map.getLayer("obsgrid-layer")){const layer={id:"obsgrid-layer",type:"fill",source:"obsgrid-source",paint:{"fill-color":{property:"obsprop",stops:map.options.fillStops},"fill-opacity":map.options.fillOpacity,"fill-outline-color":map.options.outlineColour}};map.map.addLayer(layer)}},hortis.libreMap.swapCoords=function(coords){return[coords[1],coords[0]]},hortis.libreMap.swapBounds=function(bounds){return bounds.map(hortis.libreMap.swapCoords)},hortis.libreMap.fitBounds=function(that,fitBounds){const swapped=hortis.libreMap.swapBounds(fitBounds);that.map.fitBounds(swapped,{duration:that.options.zoomDuration,essential:!0})},hortis.WGS84a=6378137,hortis.WGS84b=6356752.3142,hortis.WGS84e2=(hortis.WGS84a*hortis.WGS84a-hortis.WGS84b*hortis.WGS84b)/(hortis.WGS84a*hortis.WGS84a),hortis.longitudeLength=function(latitude){const latrad=Math.PI*latitude/180,sinrad=Math.sin(latrad);return Math.PI*hortis.WGS84a*Math.cos(latrad)/(180*Math.sqrt(1-hortis.WGS84e2*sinrad*sinrad))},hortis.latitudeLength=function(latitude){const latrad=Math.PI*latitude/180,sinrad=Math.sin(latrad);return Math.PI*hortis.WGS84a*(1-hortis.WGS84e2)/(180*Math.pow(1-hortis.WGS84e2*sinrad*sinrad,1.5))},hortis.longToLat=function(lng,lat){return lng*hortis.longitudeLength(lat)/hortis.latitudeLength(lat)},fluid.registerNamespace("hortis.obsQuantiser"),hortis.obsQuantiser.initGrid=function(){const grid={};return grid.bounds=hortis.initBounds(),grid.maxCount=0,grid.buckets={},grid},hortis.gridBucket=()=>({count:0,byTaxonId:{}}),hortis.indexObs=function(bucket,row,index){fluid.pushArray(bucket.byTaxonId,row.iNatTaxonId,index)},fluid.defaults("hortis.obsQuantiser",{gradeNames:"fluid.modelComponent",members:{newBucket:hortis.gridBucket,indexObs:hortis.indexObs,baseLatitude:"@expand:signal(37.5)",longResolution:"@expand:signal(0.005)",latResolution:"@expand:fluid.computed(hortis.longToLat, {that}.longResolution, {that}.baseLatitude)",maxBounds:"@expand:fluid.computed(hortis.obsBounds, {vizLoader}.obsRows)",grid:{expander:{funcName:"fluid.computed",args:["hortis.obsQuantiser.indexObs","{that}","{vizLoader}.finalFilteredObs","{that}.latResolution","{that}.longResolution"]}}}}),hortis.obsQuantiser.indexToCoord=function(index,latres,longres){const coords=index.split("|");return[coords[0]*latres,coords[1]*longres]},hortis.obsQuantiser.coordToIndex=function(lat,long,latres,longres){return Math.floor(lat/latres)+"|"+Math.floor(long/longres)},hortis.obsBounds=function(rows){const bounds=hortis.initBounds();return rows.forEach((function(row){hortis.updateBounds(bounds,row.decimalLatitude,row.decimalLongitude)})),bounds},hortis.obsQuantiser.indexObs=function(that,rows,latRes,longRes){const grid=hortis.obsQuantiser.initGrid(),now=Date.now();rows.forEach((function(row,index){const coordIndex=hortis.obsQuantiser.coordToIndex(row.decimalLatitude,row.decimalLongitude,latRes,longRes);hortis.updateBounds(grid.bounds,row.decimalLatitude,row.decimalLongitude);let bucket=grid.buckets[coordIndex];bucket||(bucket=grid.buckets[coordIndex]=that.newBucket()),bucket.count++,grid.maxCount=Math.max(grid.maxCount,bucket.count),that.indexObs(bucket,row,index)})),0===rows.length&&(grid.bounds=[...that.maxBounds.value]),hortis.expandBounds(grid.bounds,.1);const delay=Date.now()-now;return fluid.log("Gridded "+rows.length+" rows in "+delay+" ms: "+delay/rows.length*1e3+" us/row"),grid},fluid.defaults("hortis.libreObsMap",{gradeNames:["hortis.libreMap","hortis.libreMap.withObsGrid"],components:{obsQuantiser:{type:"hortis.obsQuantiser",options:{members:{longResolution:"@expand:signal(0.075)"}}}}});hortis=fluid.registerNamespace("hortis");fluid.defaults("hortis.autocomplete",{gradeNames:["fluid.newViewComponent"],listeners:{"onCreate.render":"hortis.autocomplete.render"},events:{onConfirm:null},maxSuggestions:20,invokers:{query:"hortis.autocomplete.emptyQuery",renderSuggestion:"fluid.identity",renderInputValue:"fluid.identity"},widgetOptions:{displayMenu:"overlay",confirmOnBlur:!1}}),hortis.autocomplete.emptyQuery=function(query,callback){callback("")},hortis.autocomplete.render=function(that){const widgetOptions=$.extend({element:that.container[0],id:that.options.id,source:that.query,templates:{suggestion:that.renderSuggestion,inputValue:that.renderInputValue},onConfirm:that.events.onConfirm.fire},that.options.widgetOptions);that.widget=accessibleAutocomplete(widgetOptions),$("input",that.container).attr("spellcheck",!1)};hortis=fluid.registerNamespace("hortis");fluid.defaults("hortis.tabs",{gradeNames:["fluid.viewComponent"],tabOptions:{},tabIds:{},model:{selectedTab:null},listeners:{"onCreate.initTabs":{this:"{that}.container",method:"tabs",args:"{that}.options.tabOptions"},"onCreate.bindEvents":{funcName:"hortis.tabs.bindEvents"}}}),hortis.tabs.findTab=function(that,tabId){return fluid.find(that.options.tabIds,(function(id,key){return id===tabId?key:void 0}))},hortis.tabs.bindEvents=function(that){that.container.on("tabsactivate",(function(event,ui){const tabId=ui.newTab.find("a").attr("href").substring(1),tab=hortis.tabs.findTab(that,tabId);that.applier.change("selectedTab",tab)}));const initialIndex=Object.keys(that.options.tabIds).indexOf(that.model.selectedTab);-1!==initialIndex&&that.container.tabs("option","active",initialIndex)};hortis=fluid.registerNamespace("hortis");var{signal:signal,effect:effect}=preactSignalsCore;hortis.sppAnnotations=["agg.","aff.","s.lat.","cf","sp.nov.","var.","sp.","ssp.","spp.","complex"],hortis.annoteRegex=new RegExp("("+hortis.sppAnnotations.map((annot=>annot.replace(".","\\."))).join("|")+")","g"),hortis.renderSpeciesName=function(name){return name.replace(hortis.annoteRegex,'<span class="checklist-annote">$1</span>')},hortis.encodeHTML=function(str){return str.replace(/[&<>'"]/g,(function(tag){return{"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"}[tag]}))},hortis.rowToScientific=function(row){return row.taxonName||row.iNaturalistTaxonName},hortis.accessRowHulq=function(row){const togo={nativeName:row.hulquminumName,scientificName:hortis.rowToScientific(row),commonName:row.commonName};return togo.featuredName=togo.nativeName||togo.commonName,togo},hortis.checklistItem=function(accessRow,entry,selectedId,simple,selectable){const record=entry.row,rowid=` data-row-id="${record.id}"`,rank=!record.rank||simple&&record.taxonName?"species":record.rank,header=`<li class="checklist-rank-${rank}${"species"===rank&&record.id===selectedId?" checklist-selected":""}">`,accessed=accessRow(record),render="species"===rank?hortis.renderSpeciesName:fluid.identity,names={};accessed.nativeName&&(names.nativeName=`<p ${rowid} class="checklist-hulq-name"><em>${accessed.nativeName}</em></p>`),accessed.scientificName&&(names.scientificName=`<p ${rowid} class="checklist-scientific-name">${render(hortis.encodeHTML(accessed.scientificName))}</p>`),accessed.commonName&&(names.commonName=`<p ${rowid} class="checklist-common-name">${accessed.commonName}</p>`);const name=Object.values(names).join(" - "),subList=hortis.checklistList(accessRow,entry.children,selectedId,simple,selectable);return header+(selectable?hortis.rowCheckbox(rowid):"")+name+subList+"</li>"},hortis.checklistList=function(accessRow,entries,selectedId,simple,selectable){return entries.length?"<ul>"+entries.map((function(entry){return hortis.checklistItem(accessRow,entry,selectedId,simple,selectable)})).join("")+"</ul>":""},hortis.checklistRowForId=function(container,id){return container.find("[data-row-id="+id+"]").closest("li")},hortis.updateChecklistSelection=function(container,newSelectedId,oldSelectedId,rowById){if(null===newSelectedId)return;hortis.checklistRowForId(container,oldSelectedId).removeClass("checklist-selected");const row=rowById[newSelectedId];if(row&&row.species){hortis.checklistRowForId(container,newSelectedId).addClass("checklist-selected")}},hortis.alwaysRejectRanks=[],hortis.acceptChecklistRowAS=function(row,filterRanks,rowFocus){const acceptBasic=!filterRanks||filterRanks.includes(row.rank)||row.species,alwaysReject=hortis.alwaysRejectRanks.includes(row.rank),rejectSpecies="species"===row.rank&&row.children.length>0,acceptChecklist=row.taxonName;return rowFocus[row.id]&&(acceptBasic&&!rejectSpecies&&!alwaysReject||acceptChecklist)},hortis.acceptChecklistRowOBA=function(row,filterRanks,idToState,rowFocus){const acceptBasic=!filterRanks||filterRanks.includes(row.rank),alwaysReject=hortis.alwaysRejectRanks.includes(row.rank);return rowFocus[row.id]&&acceptBasic&&!alwaysReject},hortis.scientificComparator=function(entrya,entryb){return hortis.rowToScientific(entrya.row)>hortis.rowToScientific(entryb.row)?1:-1},hortis.sortChecklistLevel=function(entries){return entries.sort(hortis.scientificComparator)},hortis.filterTaxonomy=function(rows,depth,acceptChecklistRow,filterTaxonomy,showRoot){const togo=[];return fluid.each(rows,(function(row){if(acceptChecklistRow(row)||0===depth&&showRoot)togo.push({row:row,children:filterTaxonomy(row.children,depth+1)});else{const dChildren=filterTaxonomy(row.children,depth+1);Array.prototype.push.apply(togo,dChildren)}})),hortis.sortChecklistLevel(togo)},hortis.SELECTED=1,hortis.UNSELECTED=0,hortis.INDETERMINATE=-1,fluid.defaults("hortis.checklist",{gradeNames:["hortis.withPanelLabel","fluid.viewComponent"],filterRanks:!1,showRoot:!1,selectable:!1,selectors:{hoverable:"p",checklist:".imerss-checklist"},invokers:{accessRow:{funcName:"hortis.accessRowHulq"},acceptChecklistRow:{funcName:"hortis.acceptChecklistRowAS",args:["{arguments}.0","{that}.options.filterRanks","{that}.rowFocus.value"]},filterTaxonomy:{funcName:"hortis.filterTaxonomy",args:["{arguments}.0","{arguments}.1","{that}.acceptChecklistRow","{that}.filterTaxonomy","{that}.options.showRoot"]},generateChecklist:{funcName:"hortis.checklist.generate",args:["{that}","{that}.dom.checklist","{layoutHolder}","{that}.filterTaxonomy","{that}.options.filterRanks","{arguments}.0"]},check:"hortis.checklist.check({that}, {arguments}.0, {arguments}.1)"},members:{idToState:"@expand:signal({})",oldIdToState:{},rowSelection:"@expand:fluid.computed(hortis.checklist.checksToSelection, {checklist}.idToState)",subscribeChecks:"@expand:hortis.checklist.subscribeChecks({that}.idToState, {that})",subscribeSelected:"@expand:hortis.checklist.subscribeSelected({that}, {that}.selectedId, {that}.rowById)",subscribeGenerate:"@expand:hortis.checklist.subscribeGenerate({that}, {that}.rootId, {that}.selectedId, {that}.rowFocus, {that}.rowById)"},listeners:{"onCreate.bindTaxonHover":"hortis.bindTaxonHover({that}, {layoutHolder})","onCreate.bindCheckboxClick":"hortis.checklist.bindCheckboxClick({that})"}}),fluid.defaults("hortis.checklist.withOBA",{invokers:{acceptChecklistRow:{funcName:"hortis.acceptChecklistRowOBA",args:["{arguments}.0","{that}.options.filterRanks","{that}.oldIdToState","{that}.rowFocus.value"]}}}),hortis.checklist.bindCheckboxClick=function(checklist){checklist.container.on("click",".pretty input",(function(){const id=this.dataset.rowId;fluid.log("Checkbox clicked with row "+id),checklist.check(id,this.checked)}))},hortis.checklist.subscribeChecks=function(idToStateSignal,checklist){let oldIdToState;return effect((()=>{const newIdToState=idToStateSignal.value;fluid.each(newIdToState,((newState,id)=>{newState!==oldIdToState[id]&&hortis.checklist.stateToCheck(checklist,newState,id)})),oldIdToState=newIdToState}))},hortis.checklist.subscribeSelected=function(that,selectedIdSignal,rowByIdSignal){let oldSelectedId;return fluid.effect((function(newSelectedId,rowById){hortis.updateChecklistSelection(that.container,newSelectedId,oldSelectedId,rowById),oldSelectedId=newSelectedId}),selectedIdSignal,rowByIdSignal)},hortis.checklist.subscribeGenerate=function(that,rootIdSignal,selectedIdSignal,rowFocusSignal,rowByIdSignal){return fluid.effect((function(rootId,selectedId,rowFocus,rowById){const model={rootId:rootId,selectedId:selectedId,rowFocus:rowFocus,rowById:rowById};that.generateChecklist(model)}),rootIdSignal,selectedIdSignal,rowFocusSignal,rowByIdSignal)},hortis.checklist.stateToCheck=function(checklist,state,id){const node=checklist.idToNode?.[id];if(node){node.checked=state===hortis.SELECTED,node.indeterminate=state===hortis.INDETERMINATE;const ui=node.closest(".p-icon").querySelector(".icon");$(ui).toggleClass("mdi-check",state!==hortis.INDETERMINATE)}},hortis.checklist.generate=function(that,element,layoutHolder,filterTaxonomy,simple,model){const{rootId:rootId,selectedId:selectedId,rowFocus:rowFocus,rowById:rowById}=model,selectable=that.options.selectable;fluid.log("Generating checklist for id "+rootId),that.oldIdToState=that.idToState.peek();const filteredEntries=filterTaxonomy(fluid.makeArray(rowById[rootId]),0);if(that.rootEntry={row:{id:hortis.checklist.ROOT_ID},children:filteredEntries},selectable){const{idToEntry:idToEntry,idToState:idToState}=hortis.checklist.computeInitialModel(that.rootEntry,rowFocus,that.oldIdToState);that.idToEntry=idToEntry,that.idToState.value=idToState}const markup=hortis.checklistList(that.accessRow,filteredEntries,selectedId,simple,selectable);if(element[0].innerHTML=markup,selectable){const checks=element[0].querySelectorAll(".checklist-check"),idToNode={};checks.forEach((check=>idToNode[check.dataset.rowId]=check)),that.idToNode=idToNode}},hortis.checklist.allChildrenState=function(idToState,entry,state){return void 0===entry.children.find((child=>idToState[child.row.id]!==state))},hortis.checklist.check=function(checklist,id,checked){const idToStateUp={...checklist.idToState.value},upState=checked?hortis.SELECTED:hortis.UNSELECTED,entry=checklist.idToEntry[id],setChildState=function(entry,state){idToStateUp[entry.row.id]=state,entry.children.forEach((child=>setChildState(child,state)))};setChildState(entry,upState);let parent=entry.parent;for(;parent;){const allChildrenState=hortis.checklist.allChildrenState(idToStateUp,parent,upState);idToStateUp[parent.row.id]=allChildrenState?upState:hortis.INDETERMINATE,parent=parent.parent}checklist.idToState.value=idToStateUp},hortis.checklist.ROOT_ID=Number.NEGATIVE_INFINITY,hortis.checklist.computeInitialModel=function(rootEntry,rowFocus,oldIdToState){const idToState={},idToEntry={},indexEntry=function(entry,parent){const id=entry.row.id;id?rowFocus[id]&&(idToState[id]=oldIdToState[id]||hortis.UNSELECTED,idToEntry[id]=entry):fluid.log("Warning, discarding row ",entry.row," without id set"),entry.parent=parent,entry.children.forEach((childEntry=>indexEntry(childEntry,entry)))};return indexEntry(rootEntry),{idToEntry:idToEntry,idToState:idToState}},fluid.defaults("hortis.checklist.withHolder",{gradeNames:["hortis.layoutHolder","hortis.checklist"]}),hortis.checklist.checksToSelection=function(idToState){const selection={},selectAll={};let selected=0;return fluid.each(idToState,((state,key)=>{state===hortis.SELECTED&&(++selected,selection[key]=!0),selectAll[key]=!0})),0===selected?selectAll:selection};
//# sourceMappingURL=imerss-viz-new.js.map